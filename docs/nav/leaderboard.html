<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../../../favicon.ico">

  <title>Proof-of-Skill</title>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="../assets/bootstrap/boostrap.min.css">
  <link rel="stylesheet" href="../assets/styles/leaderboard.css">
  <script src="https://unpkg.com/rxjs/bundles/rxjs.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  <script src="../assets/js/vendor/web3.min.js"></script>
  <script src="../assets/js/CONTACT_DATA.js"></script>
  <script src="../assets/js/connection.js"></script>
  <script src="../assets/js/leaderboard.js"></script>
</head>


<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">
      <img src="../assets/img/log.png" alt="POS" class="responsive" style="max-width: 300px; max-height: 300px;">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div style="color: #1e0010; font-weight: 700; font-size: 20px;" class="collapse navbar-collapse" id="navbarNavAltMarkup">
      <div class="navbar-nav">
        <a class="nav-item nav-link" href="tasks1.html">Задача 1</a>
        <a class="nav-item nav-link" href="tasks2.html">Задача 2</a>
        <a class="nav-item nav-link" href="tasks3.html">Задача 3</a>
        <a style="color: red;" class="nav-item nav-link" href="help.html">Помощь</a>
        <a style="color: rgb(28,168,252);" class="nav-item nav-link active" href="#">Таблица лидеров<span class="sr-only">(current)</span></a>
      </div>
    </div>
  </nav>

  <div class="container" id="root"></div>

  <script type="text/babel">
    var myWeb3, poolingInterval, userAccount, networkId, contract, userNames = {};
    console.log(mockedResults);

    class Results extends React.Component {
      constructor (props) {
        super(props);
        this.state = {};
      }
      componentDidMount() {
        hackatonResults.subscribe(results => this.setState({results}))
      }
      render(){
        let output;
        if (!this.state.results)
          return <p className="warning text-center">Loading results...</p>;
        else if (!this.state.results.length)
          return <p className="warning">No results yet...</p>;
        else return(
          <div>
            <p className="results-title">Результаты</p>
            <div className="table-responsive">
              <table className="table table-striped table-sm">
                <thead>
                  <tr>
                    <th>Место</th>
                    <th>Участник</th>
                    <th>Счёт</th>
                    <th>Задача 1</th>
                    <th>Задача 2</th>
                    <th>Задача 3</th>
                    <th>Решенные задачи</th>
                  </tr>
                </thead>
                <tbody>
                  {
                    this.state.results
                      .sort((a,b) => a.score < b.score)
                      .map((item, index) => <ResultsItem key={rnd(10)} {...item} index={index}/>)
                  }
                </tbody>
              </table>
            </div>
          </div>
        )
      }
    }

    class ResultsItem extends React.Component {
      constructor (props) {
        super();
      }
      render(){
        return(
          <tr>
            <td>{this.props.index+1}</td>
            <td className="name" title={this.props.userAddress}>{userNames[this.props.userAddress] || this.props.userAddress}</td>
            <td>{this.props.score}</td>
            <td>{date(this.props.tasks['JoiCasino'])}</td>
            <td>{date(this.props.tasks['LEGO'])}</td>
            <td>{date(this.props.tasks['FastFlow'])}</td>
            <td title={this.props.timestampScore}>{Result.readyTasks(this.props)}</td>
          </tr>
        )}
    }

    ReactDOM.render(
      <Results />,
      document.getElementById('root')
    );
    window.addEventListener('load', function() {
      startApp();
    });

    function startApp() {
      try {
        myWeb3 = checkAndInstantiateWeb3();
        initConnection(myWeb3).then(({account, network}) => {
          userAccount = account;
          networkId = network;
          if (networkId !== 4 && networkId !== 5777 && networkId !== 1337) { throw Error(messages.notRinkeby); }
          contract = new myWeb3.eth.Contract(abi, contractAddress);
          poolingInterval = setInterval(getHackatonResults, 5000);
          console.log(`Connected to ${networkId === 4 ? 'Rinkeby' : 'Local'} network`);
          console.log('Your address ' + userAccount);
          console.log('Contract address ' + contract.options.address)
        })
      } catch(err) {alert(err.message); console.error(err);}
    }
  </script>

  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="../assets/bootstrap/jquery-3.1.1.slim.min.js"></script>
  <script src="../assets/bootstrap/tether.min.js"></script>
  <script src="../assets/bootstrap/bootstrap.min.js"></script>

</body>

</html>
